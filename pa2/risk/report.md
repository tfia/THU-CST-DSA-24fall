## 算法思路和实现要点

遍历所有 $x_i$。由于保证了 $m_i \leq m_{i-1} + 1$，因此可以用优先队列维护每一个 $i-m_i$ 到 $i-1$ 天区段内 $x$ 的最大值。求出之后，对所有最大值 $k_i$ 排序。对于每组询问 $p, q$，二分查找 $k_i$ 满足阈值的分界点，根据下标就可以算出符合要求的 $k_i$ 的数量。

实现上，我对序列最前面 $m_i > i - 1$ 的部分做了特判，这一部分所对应的区段最大值就是它们之前所有元素的最大值。这样可以简化优先队列的实现。

## 渐进时间复杂度的分析

遍历序列并用优先队列维护最大值的复杂度为 $O(n)$（每个元素最多入队一次、出队一次）。采用快速排序对所有最大值排序的复杂度为 $O(n\log n)$。对 $T$ 组询问，每组询问二分查找一次，复杂度为 $O(T\log n)$。总时间复杂度为 $O(n + n\log n + T\log n)$。

## 渐进空间复杂度的分析

开了两个长度为 $n$ 的一维数组存储 $x, k$。空间复杂度为 $O(n)$。